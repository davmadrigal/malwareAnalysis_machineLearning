import os
import pandas as pd
from natsort import natsorted

# This script reads multiple CSV files from a specified directory, 
# excludes certain files, concatenates the data into a single DataFrame, 
# and saves the result to a new CSV file.

def get_csv_files(directory, exclude_files):
    """Retrieve a list of CSV files in the specified directory, excluding certain files."""
    return [file for file in natsorted(os.listdir(directory)) 
            if file.endswith('.csv') and file not in exclude_files]

def read_csv_files(file_list, directory):
    """Read CSV files and return a list of DataFrames."""
    dataframes = []
    for filename in file_list:
        filepath = os.path.join(directory, filename)
        df = pd.read_csv(filepath)
        dataframes.append(df)
    return dataframes

def concatenate_dataframes(dataframes):
    """Concatenate a list of DataFrames along the columns."""
    return pd.concat(dataframes, axis=1)

def save_to_csv(dataframe, output_file):
    """Save the DataFrame to a CSV file."""
    dataframe.to_csv(output_file, index=False, header=False)
    print(f"The files have been concatenated and saved to '{output_file}'.")

def main():
    directory = '.'  # Specify the directory where the CSV files are located
    exclude_files = ['wmi_query_All_2000reduced.csv', 
                     'guid_All_2000reduced.csv', 
                     'mutex_All_2000reduced.csv', 
                     'downloads_file_All_2000reduced.csv', 
                     'file_moved_All_2000reduced.csv']
    csv_files = get_csv_files(directory, exclude_files)
    dataframes = read_csv_files(csv_files, directory)
    result = concatenate_dataframes(dataframes)
    
    save_to_csv(result, 'final_file.csv')
    print(result.shape)

if __name__ == "__main__":
    main()

